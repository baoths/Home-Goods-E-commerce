{% extends "layout.html" %}

{% block title %}
    {{ category_name }} - Home Goods
{% endblock %}

{% block content %}
<!-- Hero Banner Section -->
{% if category and category.imageUrl %}
<div class="relative -mx-4 sm:-mx-6 lg:-mx-8 -mt-6">
    <!-- Background Image with Parallax Effect -->
    <div class="relative h-80 md:h-96 overflow-hidden">
        <div class="absolute inset-0 bg-cover bg-center bg-fixed transform scale-105" 
             style="background-image: url('{{ category.imageUrl }}');">
        </div>
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/70"></div>
        
        <!-- Content -->
        <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-4">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-4 drop-shadow-lg animate-fade-in">
                {{ category_name }}
            </h1>
            {% if category.description %}
            <p class="text-lg md:text-xl text-gray-200 max-w-2xl drop-shadow-md">
                {{ category.description }}
            </p>
            {% endif %}
            <div class="mt-6 flex items-center space-x-2 text-white/80">
                <span class="text-sm">{{ products|length }} sản phẩm</span>
            </div>
        </div>
        
        <!-- Scroll Indicator -->
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 animate-bounce">
            <svg class="w-8 h-8 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
        </div>
    </div>
</div>
{% elif current_slug == 'all' %}
<!-- All Products Hero -->
<div class="relative -mx-4 sm:-mx-6 lg:-mx-8 -mt-6">
    <div class="relative h-64 md:h-80 overflow-hidden bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500">
        <!-- Pattern Overlay -->
        <div class="absolute inset-0 opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
        
        <!-- Content -->
        <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-4">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-4 drop-shadow-lg">
                Tất Cả Sản Phẩm
            </h1>
            <p class="text-lg md:text-xl text-white/90 max-w-2xl">
                Khám phá bộ sưu tập đồ gia dụng chất lượng cao
            </p>
            <div class="mt-6 flex items-center space-x-2 text-white/80">
                <span class="text-sm">{{ products|length }} sản phẩm</span>
            </div>
        </div>
        
        <!-- Scroll Indicator -->
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 animate-bounce">
            <svg class="w-8 h-8 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
        </div>
    </div>
</div>
{% else %}
<!-- Fallback Hero without image -->
<div class="relative -mx-4 sm:-mx-6 lg:-mx-8 -mt-6">
    <div class="relative h-48 md:h-64 overflow-hidden bg-gradient-to-r from-gray-700 to-gray-900">
        <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-4">
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-2">
                {{ category_name }}
            </h1>
            <div class="mt-4 text-white/80">
                <span class="text-sm">{{ products|length }} sản phẩm</span>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Products Section -->
<div class="mt-8 md:mt-12">
    {% if error %}
        <div class="text-center py-16 bg-white rounded-xl shadow-sm">
            <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="mt-4 text-xl font-semibold text-gray-700">{{ category_name }}</h3>
            <p class="mt-2 text-gray-500">{{ error }}</p>
        </div>
    {% elif products and products|length > 0 %}
        <!-- Filter/Sort Bar -->
        <div class="flex flex-wrap items-center justify-between gap-4 mb-8 bg-white rounded-xl shadow-sm p-4">
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-500">Hiển thị {{ products|length }} sản phẩm</span>
            </div>
            <div class="flex items-center space-x-3">
                <label class="text-sm text-gray-600">Sắp xếp:</label>
                <select id="sortSelect" class="text-sm border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 px-3 py-2">
                    <option value="newest">Mới nhất</option>
                    <option value="price_asc">Giá: Thấp → Cao</option>
                    <option value="price_desc">Giá: Cao → Thấp</option>
                    <option value="name">Tên A-Z</option>
                </select>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="grid grid-cols-2 gap-4 sm:gap-6 lg:grid-cols-3 xl:grid-cols-4" id="productsGrid">
            {% for product in products %}
            <div class="group bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                <!-- Product Image -->
                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="block relative aspect-square overflow-hidden bg-gray-100">
                    <img src="{{ product.imageUrl }}" 
                         alt="{{ product.name }}" 
                         class="h-full w-full object-cover object-center group-hover:scale-110 transition-transform duration-500">
                    
                    {% if product.discount and product.discount|float > 0 %}
                    <div class="absolute top-3 left-3 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                        -{{ product.discount|int }}%
                    </div>
                    {% endif %}
                    
                    {% if product.featured %}
                    <div class="absolute top-3 right-3 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded-full">
                        HOT
                    </div>
                    {% endif %}
                    
                    <!-- Quick View Overlay -->
                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                        <span class="text-white font-medium text-sm bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full">
                            Xem chi tiết
                        </span>
                    </div>
                </a>
                
                <!-- Product Info -->
                <div class="p-4">
                    <a href="{{ url_for('product_detail', product_id=product.id) }}" class="block">
                        <h3 class="text-sm font-semibold text-gray-800 line-clamp-2 group-hover:text-indigo-600 transition-colors min-h-[2.5rem]">
                            {{ product.name }}
                        </h3>
                    </a>
                    
                    <div class="mt-2 flex items-center justify-between">
                        <div>
                            {% if product.discount and product.discount|float > 0 %}
                                {% set discounted_price = product.price|float * (1 - product.discount|float / 100) %}
                                <p class="text-lg font-bold text-red-600">{{ "{:,.0f}".format(discounted_price) }}₫</p>
                                <p class="text-xs text-gray-400 line-through">{{ "{:,.0f}".format(product.price|float) }}₫</p>
                            {% else %}
                                <p class="text-lg font-bold text-indigo-600">{{ "{:,.0f}".format(product.price|float) }}₫</p>
                            {% endif %}
                        </div>
                        
                        {% if product.stock is defined %}
                            {% if product.stock|int > 0 %}
                            <span class="text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full">Còn hàng</span>
                            {% else %}
                            <span class="text-xs text-red-600 bg-red-50 px-2 py-1 rounded-full">Hết hàng</span>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-16 bg-white rounded-xl shadow-sm">
            <svg class="mx-auto h-20 w-20 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
            <h3 class="mt-6 text-xl font-semibold text-gray-700">Chưa có sản phẩm</h3>
            <p class="mt-2 text-gray-500">Danh mục này chưa có sản phẩm nào.</p>
            <a href="{{ url_for('category', slug='all') }}" class="mt-6 inline-flex items-center px-6 py-3 bg-indigo-600 text-white font-medium rounded-full hover:bg-indigo-700 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Xem tất cả sản phẩm
            </a>
        </div>
    {% endif %}
</div>

<style>
@keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in {
    animation: fade-in 0.8s ease-out;
}
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}
