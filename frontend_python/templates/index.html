{% extends "layout.html" %}

{% block title %}
    Products - Home Goods
{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6 md:p-8">

    {% if banners %}
    <div class="mb-12 relative w-full -m-6 md:-m-8 rounded-t-lg overflow-hidden" id="banner-carousel">
        <div class="relative w-full overflow-hidden" style="height: 400px;">
            {% for banner in banners %}
            <div class="banner-slide absolute w-full h-full transition-opacity duration-700 ease-in-out {% if loop.first %}opacity-100{% else %}opacity-0{% endif %}">
                <img src="{{ banner.imageUrl }}" alt="{{ banner.title }}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col items-center justify-center text-center p-4">
                    <h2 class="text-4xl font-bold text-white mb-2">{{ banner.title }}</h2>
                    <p class="text-xl text-gray-200 mb-4">{{ banner.subtitle }}</p>
                    <a href="{{ banner.link if banner.link else url_for('category', slug='all') }}" class="mt-2 px-6 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700 transition-colors">
                        Shop Now
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <button id="prevBtn" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-white bg-opacity-50 p-2 rounded-full hover:bg-opacity-75 focus:outline-none z-10">
            <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <button id="nextBtn" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-white bg-opacity-50 p-2 rounded-full hover:bg-opacity-75 focus:outline-none z-10">
            <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>
    </div>
    {% endif %}

    <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold tracking-tight text-gray-900">Featured Products</h2>
        <!-- Can add filters or search bar here later -->
    </div>

    {% if products %}
        <div class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8">
            {% for product in products %}
            <a href="{{ url_for('product_detail', product_id=product.id) }}" class="group relative border rounded-lg overflow-hidden shadow-sm hover:shadow-xl transition-shadow duration-300 block">
                <div class="aspect-h-1 aspect-w-1 w-full bg-gray-200 lg:aspect-none group-hover:opacity-80 transition-opacity duration-300 lg:h-64">
                    <img src="{{ product.imageUrl }}" alt="{{ product.name }}" class="h-full w-full object-cover object-center">
                </div>
                <div class="p-4">
                    <div class="flex justify-between items-start">
                        <h3 class="text-md font-semibold text-gray-800">
                            {{ product.name }}
                        </h3>
                        <p class="text-md font-medium text-indigo-600">{{ "{:,.0f}".format(product.price) }}â‚«</p>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">{{ product.category.name if product.category else 'Uncategorized' }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-16">
            <h3 class="text-xl font-semibold text-gray-700">No Products Found</h3>
            <p class="mt-2 text-gray-500">Please make sure the backend server is running and has data.</p>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('banner-carousel');
    if (!carousel) return;

    const slides = carousel.querySelectorAll('.banner-slide');
    if (slides.length <= 1) return;

    let currentSlide = 0;
    const prevBtn = carousel.querySelector('#prevBtn');
    const nextBtn = carousel.querySelector('#nextBtn');

    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.classList.toggle('opacity-100', i === index);
            slide.classList.toggle('opacity-0', i !== index);
        });
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
    }

    function prevSlide() {
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        showSlide(currentSlide);
    }

    nextBtn.addEventListener('click', nextSlide);
    prevBtn.addEventListener('click', prevSlide);

    setInterval(nextSlide, 5000); // Auto-play every 5 seconds
});
</script>
{% endblock %}
